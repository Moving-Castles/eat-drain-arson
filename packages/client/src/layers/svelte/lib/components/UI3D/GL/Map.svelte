<script lang="ts">
  // TYPES
  import type { GridTile } from "../../UIGridMap";
  // GAME
  import { blockNumber } from "../../../../modules/network";
  import { playerAddress } from "../../../../modules/player";
  import { entities } from "../../../../modules/entities";
  // import { entities } from "../../../../modules/gamestate";
  import { initGrid, updateGrid } from "../../UIGridMap";
  // GL
  import { T } from "@threlte/core";
  import Camera from "./Camera.svelte";
  import Entity from "./entities/Entity.svelte";
  import Core from "./entities/Core.svelte";
  import Tile from "./Tile.svelte";
  import Background from "./Background.svelte";
  // THREE
  import { DEG2RAD } from "three/src/math/MathUtils";
  import { MeshBasicMaterial } from "three";

  const UNIT = 10;

  let grid: GridTile[] = [];

  grid = initGrid(UNIT);

  blockNumber.subscribe(async () => {
    grid = await updateGrid(grid);
  });
</script>

<!-- BASE LAYER -->
<T.Group>
  <!-- Floor -->
  {#each grid as tile (`${tile.coordinates.x}-${tile.coordinates.y}`)}
    <Tile {tile} />
  {/each}

  <T.Group position.x={4.5} position.z={4.5}>
    <Background />
  </T.Group>

  <!-- Entities -->
  {#each Object.entries($entities) as [id, entity] (id)}
    <!-- Your position in the world -->
    <Entity {id} {entity} />
  {/each}
</T.Group>
